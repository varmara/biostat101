<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Ограничения статистических методов. Непараметрические методы.</title>
    <meta charset="utf-8" />
    <meta name="author" content="Марина Варфоломеева" />
    <script src="site_libs/header-attrs-2.18/header-attrs.js"></script>
    <link href="site_libs/remark-css-0.0.1/ninjutsu.css" rel="stylesheet" />
    <link href="site_libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="site_libs/tile-view-0.2.6/tile-view.js"></script>
    <script src="site_libs/fabric-4.3.1/fabric.min.js"></script>
    <link href="site_libs/xaringanExtra-scribble-0.0.1/scribble.css" rel="stylesheet" />
    <script src="site_libs/xaringanExtra-scribble-0.0.1/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <script src="site_libs/mark.js-8.11.1/mark.min.js"></script>
    <link href="site_libs/xaringanExtra-search-0.0.1/search.css" rel="stylesheet" />
    <script src="site_libs/xaringanExtra-search-0.0.1/search.js"></script>
    <script>window.addEventListener('load', function() { window.xeSearch = new RemarkSearch({"position":"bottom-left","caseSensitive":false,"showIcon":false,"autoSearch":true}) })</script>
    <script src="site_libs/xaringanExtra-progressBar-0.0.1/progress-bar.js"></script>
    <script src="site_libs/freezeframe-5.0.2/freezeframe.min.js"></script>
    <script src="site_libs/xaringanExtra-freezeframe-0.0.1/freezeframe-init.js"></script>
    <script id="xaringanExtra-freezeframe-options" type="application/json">{"selector":"img[src$=\"gif\"]","trigger":"click","overlay":false,"responsive":true,"warnings":true}</script>
    <link href="site_libs/tachyons-4.12.0/tachyons.min.css" rel="stylesheet" />
    <script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <!-- https://github.com/fnaufel/xaringan-smartify-->
    <script
    			  src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    			  integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="
    			  crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/fnaufel/xaringan-smartify/smartify.min.js"></script>
    <link rel="stylesheet" href="assets/xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="assets/xaringan.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: middle, left, inverse, title-slide

.title[
# Ограничения статистических методов. Непараметрические методы.
]
.subtitle[
## Основы биостатистики, осень 2022
]
.author[
### Марина Варфоломеева
]

---






&lt;!-- - Тесты на нормальность распределения --&gt;
- Трансформации данных
- Непараметрические методы
- Альтернативы одновыборочному и парному t-тестам
  - Тест знаков и тест Вилкоксона
- Альтернативы двухвыборочному t-тесту
  - Тест U Манна-Уитни и тест Колмогорова-Смирнова
- Пермутационные тесты

---

## Если нарушаются условия применимости метода

--

.pull-left[
__Подход__

- параметрический метод с другими условиями применимости
]

--

.pull-right[
__Пример использования__

- обобщенная линейная модель, вместо простой линейной регрессии
]

--

.pull-left[
- подходящая трансформация данных `\(^*\)`
]
.pull-right[
- логарифмирование счетных данных для нормализации формы распределения
]

--

.pull-left[
- непараметрические методы `\(^*\)`
]
.pull-right[
- тест Вилкоксона вместо t-теста
]

--

.pull-left[
- пермутационные тесты `\(^*\)`
]
.pull-right[
- распределения любых статистик для `\(H_0\)` генерируются из самих данных
]

---

class: middle, center, inverse

# Трансформация данных

---

## Трансформация данных

__Трансформация данных__ — математическая операция, которую применяют к значениям переменной (т.е. к ряду данных целиком, а не к единичным наблюдениям)

- для коррекции формы распределения
- для выравнивания дисперсий

--

### Самые распространенные трансформации

- логарифм
- квадратный корень
- арксинус-преобразование

???

Не всегда лучший, но самый простой способ.

---

## Логарифмирование



.pull-left[

&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/gg-log-1.png" width="432" /&gt;
]

.pull-right[

`$$x^\prime = \log(x)$$`

Если в данных есть нули, то прибавляют маленькую константу `\(x^\prime = \log(x + 1)\)`.

]

--

.pull-left[
&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/gg-dlognorm-1.png" width="432" /&gt;

]

--

.pull-right[
&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/gg-dlognorm-t-1.png" width="432" /&gt;
]

--

Подойдет, если 

- распределение имеет длинный правый хвост
- измерения — это отношения, произведения, подсчеты численности
- в группах с большим средним большое стандартное отклонение
- диапазон данных несколько порядков 

---

## Извлечение корня



.pull-left[
&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/gg-sqrt-1.png" width="432" /&gt;

]
.pull-right[

`$$x^\prime = \sqrt{x}$$`

Иногда используют корни других степеней.

]

--

.pull-left[
&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/gg-dsqrt-1.png" width="432" /&gt;

]

--

.pull-right[
&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/gg-dsqrt-t-1.png" width="432" /&gt;
]

--

Подойдет, если 

- распределение имеет длинный левый хвост
- данные - это подсчеты численности
- в группах с большим средним большое стандартное отклонение

---

## Арксинус-преобразование для долей

.pull-left[
&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/gg-asin-1.png" width="432" /&gt;

]
.pull-right[
`$$p^\prime = \arcsin{\sqrt{p}}$$`

Значения долей ограничены `\(0 \le p \le 1\)`.
Если много долей, близких к 0 или 1, трансформация "растянет" концы шкалы.
]

--

Усовершенствованные варианты:

- `\(p^\prime = \arcsin{\sqrt{\cfrac{x + 3/8}{n + 3/4}}}\)` (Johnson, Kotz, 1969)
- `\(p^\prime = 2\sqrt{n}\cdot\Big(\arcsin{\sqrt{\cfrac{x + 3/8}{n + 3/4}}} - \arcsin{\sqrt{p}}\Big)\)` (Freeman, Tukey, 1950)


---

## Основные трансформации данных

&lt;br/&gt;

### Степенные

| Название         | Трансформация   | Обратная трансформация |
| ---------------- | --------------- | ---------------------- | 
| степень -2       | `\(x^\prime = 1/x^2\)`         | `\(x = \sqrt{1/x^\prime}\)` |
| степень -1       | `\(x^\prime = 1/x\)`           | `\(x = 1/x^\prime\)`        |
| степень -0.5     | `\(x^\prime = 1/\sqrt{x}\)`    | `\(x = 1/x^{\prime~2}\)`    |
| степень 0.5      | `\(x^\prime = \sqrt{x}\)`      | `\(x = x^{\prime~2}\)`      |
| логарифмирование | `\(x^\prime = \log(x)\)`        | `\(x = e^{x}\)`             |
&lt;br/&gt;

### Для долей&lt;br/&gt;

| Название         | Трансформация   | Обратная трансформация |
| ---------------- | --------------- | ---------------------- | 
| Арксинус-трансформация | `\(p^\prime = \arcsin{\sqrt{p}}\)` | `\(p = \sin(p^\prime)^2\)` |
| Логит-преобразование   | `\(p^\prime = \log{\Big(\cfrac{p}{1-p}\Big)}\)` | `\(p = \cfrac{e^{p^\prime}}{1+e^{p^\prime}} = \cfrac{1}{1+e^{-p^\prime}}\)` |


---

## Подбор подходящей трансформации

Нечестно специально выбирать трансформацию, приводящую к наиболее значимому результату теста.

Выбирайте трансформацию, которая лучше всего приближает к выполнению условий применимости.

---

## Пример: морские заповедники

Эффективны ли морские заповедники для сохранения природы (Halpern, 2003)?

32 пары заповедник—контрольная точка (до заповедника или рядом с ним)

Показатель успеха защиты `\(I = \cfrac{B_\text{заповедник}}{B_\text{контроль}}\)`.

`\(H_0: \mu = 1\)` — среднее отношение биомасс не зависит от статуса акватории
`\(H_1: \mu \ne 1\)` — среднее отношение биомасс различается в охраняемых и не охраняемых акваториях

---

## Проверяем условия для одновыборочного t-теста

&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/gg-MR-1.png" width="864" /&gt;

--

Асимметрия вправо. Попробуем логарифмировать данные.

--

&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/gg-MR-log-1.png" width="864" /&gt;

--

Неидеально, но явно лучше. 

---

## Одновыборочный t-тест по трансформированным данным

- `\(H_0: \mu = 0\)` — средний логарифм отношения биомасс не зависит от статуса
- `\(H_1: \mu \ne 0\)` — средний логарифм отношения биомасс различается  
  в защищенных и не защищенных акваториях

--

Формулировка изменилась, т.к. `\(log(1) = 0\)`

--



&lt;br/&gt;

В нашем примере средний логарифм отношения биомасс `\(\overline {log(I)} = \overline{log\Big(\frac{B_\text{заповедник}}{B_\text{контроль}}\Big)} = 0.479\)`.

--

&lt;br/&gt;

`\(s = 0.366\)`, `\(n = 32\)`

`\(t = \frac{0.479 - 0}{0.366 / \sqrt{32}} = 7.40\)`, `\(df = 32 - 1 = 31\)`

&lt;br/&gt;

`\(p = 2.49e-08\)`

Т.е. средний логарифм биомассы статистически значимо выше в охраняемых акваториях.


---

## Доверительный интервал по трансформированным данным


`$$\overline {log(I)} - t_{\alpha, df} \cdot SE_{\overline {log(I)}} \le \overline {log(I)} \le \overline {log(I)} + t_{\alpha, df} \cdot SE_{\overline {log(I)}}$$`

--

В этом интервале лежит средний логарифм (в 95% провторных выборок):

`$$0.479 - 2.04 \cdot \frac{0.366} {\sqrt{32}} \le \overline {log(I)} \le 0.479 + 2.04 \cdot \frac{0.366} {\sqrt{32}}$$`

--

`$$0.347 \le \overline {log(I)} \le 0.611$$`

--

Само среднее (геометрическое - из-за логарифмирования)  
лежит в другом интервале: 

`$$e^{0.347}  \le \text{среднее геометрическое } {I} \le  e^{0.611}$$`

--

`$$1.415  \le \text{среднее геометрическое } {I} \le  1.843$$`

--

Т.е. в заповедниках биомасса в среднем выше, чем в неохраняемых акваториях в `\(1.415\)` — `\(1.843\)` раз.

---

class: middle, center, inverse

# Непараметрические методы

---

## Непараметрические методы

- не делают никаких предположений о значениях __параметров__ статистических распределений
- имеют менее жесткие условия применимости (например, не требуют нормальности)
- часто основаны на использовании рангов

---

## Ранги


.pull-left[

Допустим, вы поймали несколько ящериц и измерили их длину (см).

10, 4, 7, 8, 7, 6, 11, 6, 13, 6, 10

![:scale 80%](img/lizards-unsorted.png)

]

--

.pull-right[
&lt;br/&gt;
Данные можно рассортировать.

4, 6, 6, 6, 7, 7, 8, 10, 10, 11, 13

![:scale 80%](img/lizards-sorted.png)

]

--

.pull-left[

__Ранг__ наблюдения — это его порядковый номер в отсортированном ряду. Одинаковые наблюдения ("связанные ранги", tied ranks) получат один и тот же ранг — чаще это среднее их номеров.
]

--

.pull-right[
1, 3, 3, 3, 5.5, 5.5, 7, 8.5, 8.5, 10, 11
]

--

&lt;br/&gt;

Исходные значения можно заменить на их ранги и работать уже с ними.

8.5, 1, 5.5, 7, 5.5, 3, 10, 3, 11, 3, 8.5

---

## Ошибки I и II рода



.pull-left[
__Вероятность ошибки I рода__

У параметрических тестов соответствует `\(\alpha\)` только если выполнены условия применимости. Если нет, то увеличивается.


У непараметрических тестов — соответствует  `\(\alpha\)`, если выполнены более мягкие условия применимости.
]

.pull-right[
__Вероятность ошибки II рода__

&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;

У непараметрических тестов увеличивается вероятность ошибки II рода `\(\beta\)`, из-за потери информации при переходе к рангам.
]

---

class: middle, center, inverse

# Проверка гипотез для одной или парных выборок  
при помощи непараметрических тестов

---

## Тест знаков

Sign test

Альтернатива одновыборочному или парному t-тестам, когда данные не подчиняются нормальному распределению.

Проверяет равенство медианы переменной `\(x\)` конкретному значению `\(m_0\)`.

- `\(H_0: m = m_0\)`
- `\(H_A: m \ne m_0\)`

--

Обозначим `\(x &gt; m_0\)` как "+", а `\(x &lt; m_0\)` как "—", остальные не будем учитывать вообще.

--

При `\(H_0\)` можно ожидать что, доля "+" и "—" равна 0.5.

--

Для вычисления p используется биномиальное распределение.

---

## Пример: половой конфликт и происхождение видов

Половой конфликт более выражен у видов, чьи самки спариваются больше одного раза. Значит ли это, что у них быстрее видообразование (Arnqvist et al., 2000)?

25 пар групп насекомых со множественным и однократным спариванием.

В каких из этих групп таксонов больше родственных видов?

.small[
.scroll-box-18[
&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;Спаривание (число таксонов)&lt;/div&gt;&lt;/th&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Пара таксонов &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Множественное &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Однократное &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Разница &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 73 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 120 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -47 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; C &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 228 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 74 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 154 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; D &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 353 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 289 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; E &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 157 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 127 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 300 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 296 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; G &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; H &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3400 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3500 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -100 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; I &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -980 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; J &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 196 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 486 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -290 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; K &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1750 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 660 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1090 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; L &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 115 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -78 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; N &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; O &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20940 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; P &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -3 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Q &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; S &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; T &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 240 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 227 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; U &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; V &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 77 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 61 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; W &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; X &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 85 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 79 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Y &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 86 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 78 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]]

---

## Проверяем условия для одновыборочного t-теста

&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/gg-SC-1.png" width="864" /&gt;

--

Есть наблюдение-выброс — таксон, в котором видов со множественным спариванием на 20400 больше, чем с однократным.

Никакая трансформация не поможет.

---

## Гипотезы для теста знаков

- `\(H_0: m = m_0\)` — медианная разница числа видов между группами  
со множественным и однократным спариванием равна 0.
- `\(H_A: m \ne m_0\)` — медианная разница числа видов между этими группами не равна 0.

--

&lt;br/&gt; 

При `\(H_0\)` разница числа видов &gt; 0 у половины наблюдений, а у другой половины &lt; 0.

--

Тест знаков — это биномиальный тест.

---

## Расставляем знаки

.small[
.scroll-box-26[
&lt;table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;Спаривание (число таксонов)&lt;/div&gt;&lt;/th&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="2"&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Пара таксонов &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Множественное &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Однократное &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Разница &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Знак &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 73 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 120 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -47 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;text-align: center;"&gt;-&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; C &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 228 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 74 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 154 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; D &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 353 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 289 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; E &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 157 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 127 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 300 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 296 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; G &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; H &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3400 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3500 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -100 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;text-align: center;"&gt;-&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; I &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -980 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;text-align: center;"&gt;-&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; J &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 196 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 486 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -290 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;text-align: center;"&gt;-&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; K &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1750 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 660 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1090 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; L &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -8 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;text-align: center;"&gt;-&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 115 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -78 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;text-align: center;"&gt;-&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; N &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; O &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20940 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; P &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;text-align: center;"&gt;-&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Q &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; S &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; T &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 240 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 227 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; U &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; V &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 77 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 61 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; W &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; X &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 85 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 79 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Y &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 86 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 78 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;text-align: center;"&gt;+&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]]

--

&lt;br/&gt;

Подсчитаем количество

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; - &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; + &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

## Тест знаков

Гипотезы можно переформулировать как для биномиального теста

.pull-left[

`\(H_0: \pi = 0.5\)` — доля "-" в генеральной совокупности равна `\(0.5\)`

`\(H_A: \pi \ne 0.5\)` — доля "-" не равна `\(0.5\)`

]
.pull-right[

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; - &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; + &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

]

--

&lt;br/&gt;

Биномиальное распределение:  
`\(P(X \text{'успех'}) = \frac{n!}{X! (n-X)!} \pi^X (1 - \pi)^{n-X}\)`

--

&lt;br/&gt;

Какова вероятность получить `\(\le 7\)` "-" из 25 когда `\(p_{\text{"-"}} = 0.5\)`?

--

Находим и суммируем вероятности для 0-7:

`$$P(X \le 7) = \sum^7_{i = 0} \frac{25!}{i! (25-i)!} 0.5^i (1 - 0.5)^{25-i} = 0.02164$$`

--

Двусторонняя альтернативная гипотеза, поэтому `\(p = 2 \cdot 0.02164 = 0.043\)`

---

## Тест знаковых рангов Вилкоксона

Wilcoxon signed-rank test

"Усовершенствованная" (плохо) версия теста знаков.

Сохраняет информацию о величине отличия от `\(m_0\)`.

--

&lt;br/&gt;

__Осторожно!__

Условие применимости: распределение измерений __симметрично__ относительно медианы.

Почти невыполнимо, т.к. в большинстве случаев проблемы с нормальностью распределения именно из-за асимметрии.

--

&lt;br/&gt;

Лучше использовать тест знаков.

---

class: middle, center, inverse

# Сравнение двух групп &lt;br/&gt;
при помощи непараметрических тестов

---

## Тест U Манна-Уитни

The Mann-Whitney U-test 

Альтернатива двухвыборочному t-тесту.

По ранжированным данным сравнивает среднее значение рангов в двух выборках.

p-значение зависит от степени несоответствия средних рангов.

--

&lt;br/&gt;

Особенности:

- Регистрирует в основном различия медиан
- Есть адаптации для связанных рангов

--

&lt;br/&gt;

= тест суммы рангов Вилкоксона (Wilcoxon rank sum test). 

Не путайте с тестом знаковых рангов Вилкоксона.



???

Приблизительные значения p можно найти по трансформированным значениям U-статистики.
Их распределение можно аппроксимировать нормальным.

`\(Z=\frac{2 U-n_1 n_2}{\sqrt{n_1 n_2\left(n_1+n_2+1\right) / 3}}\)`


---

## Пример: канибализм у сверчков

У сверчков Cyphoderris strepitans  во время спаривания самец предлагает самке съесть свои мясистые крылья.

Зависит ли вероятность спаривания от того, голодные ли самки (Johnson, 1999)?

Свежих самцов предлагали самкам из двух групп:

- 11 голодных 
- 13 сытых

Регистрировали время до начала спаривания.

---


## Проверяем условия для двухвыборочного t-теста

&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/gg-CR-1.png" width="864" /&gt;

--

Асимметрия вправо. В одной группе есть выброс. В другой полимодальное распределение. Малый объем выборки.

Логарифмирование не поможет.

---

## Медианное время до спаривания

- у голодных самок 13.0 ч.
- у сытых самок 22.8 ч.

&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/unnamed-chunk-9-1.png" width="576" /&gt;

&lt;br/&gt;

Гипотезы для теста Манна-Уитни

- `\(H_0: m_1 - m_2 = 0\)` — медианное время до спаривания одинаковое  
у сытых и голодных самок.
- `\(H_A: m_1 - m_2 \ne 0\)` — медианное время до спаривания разное  
у сытых и голодных самок.

---

## Ранжируем данные
.pull-left-40[

.small[
.scroll-box-26[
&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Аппетит &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Время до спаривания &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Ранг &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 1.5 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 1.7 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightcoral !important;font-weight: bold;"&gt; Голодные &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 1.9 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 3 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightcoral !important;font-weight: bold;"&gt; Голодные &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 2.1 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 4 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 2.4 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 3.6 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 6 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightcoral !important;font-weight: bold;"&gt; Голодные &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 3.8 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 7 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 5.7 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightcoral !important;font-weight: bold;"&gt; Голодные &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 9.0 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightcoral !important;font-weight: bold;"&gt; Голодные &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 9.6 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 10 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightcoral !important;font-weight: bold;"&gt; Голодные &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 13.0 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 11 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightcoral !important;font-weight: bold;"&gt; Голодные &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 14.7 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 12 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightcoral !important;font-weight: bold;"&gt; Голодные &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 17.9 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 13 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightcoral !important;font-weight: bold;"&gt; Голодные &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 21.7 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 14 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 22.6 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 15 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 22.8 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 16 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightcoral !important;font-weight: bold;"&gt; Голодные &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 29.0 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 17 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 39.0 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 18 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 54.4 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 19 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 72.1 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 20 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightcoral !important;font-weight: bold;"&gt; Голодные &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 72.3 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightcoral !important;"&gt; 21 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 73.6 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 22 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 79.5 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 23 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: black !important;background-color: lightblue !important;font-weight: bold;"&gt; Сытые &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 88.9 &lt;/td&gt;
   &lt;td style="text-align:right;color: black !important;background-color: lightblue !important;"&gt; 24 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]
]]
.pull-right-60[

Сумма рангов в группе 1 (голодные): `\(R_1 = 121\)` 

]

--

&lt;br/&gt;
Сколько раз у наблюдений из группы 1 меньший ранг, чем в группе 2 (во всех возможных парах):  
`\(U_1 = n_1 \cdot n_2 + \cfrac{n_1 (n_1 + 1)}{2} - R_1 = \\ = 11 \cdot 13 +\cfrac{11(11+1)}{2} - 121 = 88\)`

--
&lt;br/&gt;
Аналогично для группы 2:  
`\(U_2 = n_1 \cdot n_2 - U_1 = 11 \cdot 13 - 88 = 55\)`

--

&lt;br/&gt;
Максимальное из них — это U-статистика:
`\(U = U_1 = 88\)`

--

&lt;br/&gt;
P-значение определяем по U-распределению. 

Критическое значение `\(U_{0.05, df = 2, n_1 = 11, n_2  = 13} = 106\)`,
поэтому `\(p &gt; 0.05\)`, сохраняем `\(H_0\)`.



---

## Тест Колмогорова-Смирнова

The Kolmogorov-Smirnov test 

Сравнивает кумулятивное распределение в двух выборках (goodness-of-fit test).

p-значение зависит от степени несоответствия кумулят.

--

&lt;br/&gt;

__Недостатки__:

- Регистрирует любые различия формы распределений. Т.е. не умеет отличать положение медианы от различий размаха и асимметрии.
- Плохо работает со связанными рангами.

--

&lt;br/&gt;

Лучше использовать тест U Манна-Уитни

---

class: middle, center, inverse

# Пермутационные методы

---

## Пермутационные методы

- используют перестановки (пермутации, permutations) исходных данных для тестирования гипотез

--
  - о равенстве средних (аналог t-тестов)

--
  - о связи между категориальными переменными (таблицы сопряженности)

--
  - о связи между непрерывными переменными (коэффициент корреляции)

--
- делают меньше предположений о распределении данных

---

## Пермутационный тест в общем виде

.pull-left-60[
__0.__ Вычисляем тестовую статистику на исходных данных.
]
.pull-right-40[
![](img/permutations-0.png)
]

--

.pull-left-60[
__1.__ Делаем пермутации

Случайно переставляем данные, смешивая сравниваемые группы.  
Это моделирует ситуацию для `\(H_0\)`.
]
.pull-right-40[
&lt;br/&gt;
![](img/permutations-01.png)
]

---

## Пермутационный тест в общем виде

.pull-left-60[
__0.__ Вычисляем тестовую статистику на исходных данных.
]
.pull-right-40[
![](img/permutations-0.png)
]

.pull-left-60[
__1.__ Делаем пермутации

Случайно переставляем данные, смешивая сравниваемые группы.  
Это моделирует ситуацию для `\(H_0\)`.

__2.__ Вычисляем тестовую статистику на пермутированных данных.

]

.pull-right-40[
![](img/permutations-1.png)
]

---

## Пермутационный тест в общем виде

.pull-left-60[
__0.__ Вычисляем тестовую статистику на исходных данных.
]
.pull-right-40[
![](img/permutations-0.png)
]

.pull-left-60[
__1.__ Делаем пермутации

Случайно переставляем данные, смешивая сравниваемые группы.  
Это моделирует ситуацию для `\(H_0\)`.

__2.__ Вычисляем тестовую статистику на пермутированных данных.

__3.__ Повторяем 1 и 2 много раз ( `\(\ge 1000\)`)

Получаем распределение тестовой статистики при `\(H_0\)` (с учетом вычисленного про исходным данным значения).

]
.pull-right-40[
![](img/permutations-2.png)
]

--

.pull-left-60[
__4.__ Вычисляем p

Например, в двустороннем тесте разницы средних, если статистика &gt;0, _p_ — удвоенная доля пермутаций, где значение статистики больше исходного (и наоборот, если &lt; 0).

]
.pull-right-40[
![](img/permutations-3.png)
]




---

## Условия применимости пермутационного теста о сравнении средних

- данные — это случайная выборка
- распределение переменной одинаковое в сравниваемых группах (устойчив при больших выборках)

--

- p-значение зависит от количества пермутаций

--

Число возможных пермутаций `\(n!\)`,  
т.е. годится для не слишком малых выборок ( `\(n&gt;5\)` или `\(7\)`).


---

## Мощность

- При малых выборках мощность меньше, чем у параметрического t-теста, но больше, чем у теста U Манна-Уитни.
- При больших выборках сходная мощность у всех трех типов.

---

## Пермутационный тест для сверчков-каннибалов




### Считаем статистику на исходных данных

.pull-left-40[

.small[.scroll-box-30[
&lt;table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Аппетит &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Время до спаривания &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;1.9&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;2.1&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;3.8&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;9&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;9.6&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;13&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;14.7&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;17.9&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;21.7&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;29&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;72.3&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;1.5&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;1.7&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;2.4&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;3.6&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;5.7&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;22.6&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;22.8&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;39&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;54.4&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;72.1&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;73.6&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;79.5&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;88.9&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]
]]

.center[
Среднее время до спаривания

у голодных самок `\(\bar y_{голодные} = 17.73\)`

у сытых самок `\(\bar y_{сытые} = 35.98\)`

&lt;br/&gt;

Разница `\(y_{голодные}  - y_{сытые}  = -18.26\)`
]

---

### Считаем статистику на пермутированных данных

.pull-left-40[

.small[.scroll-box-30[
&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Аппетит &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Время до спаривания &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;1.9&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;2.1&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;3.8&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;9&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;9.6&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;13&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;14.7&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;17.9&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;21.7&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;29&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: red !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;72.3&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;1.5&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;1.7&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;2.4&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;3.6&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;5.7&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;22.6&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;22.8&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;39&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;54.4&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;72.1&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;73.6&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;"&gt;Сытые&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;79.5&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightcoral !important;"&gt;Голодные&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     color: navyblue !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;"&gt;88.9&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]
]]

.center[
Среднее время до спаривания в этой пермутации получилось

у голодных самок `\(\bar y_{голодные_1} = 35.66\)`

у сытых самок `\(\bar y_{сытые_1} = 20.81\)`

&lt;br/&gt;

Разница `\(y_{голодные_1}  - y_{сытые_1}  = 14.86\)`
]

---

### Распределение статистики по пермутированным данным

Если процесс повторить 10000 раз, получится такое распределение




В нашем двустороннем тесте p-значение — это удвоенная доля пермутаций, в которых значение меньше исходного.

`\(p = 2 \cdot 0.0672 = 0.134\)`

--

Сохраняем `\(H_0\)`

Т.е. не обнаружено статистически-значимых различий среднего времени до спаривания у голодных и сытых самок.

---

## Обращайте внимание, что вы сравниваете


&lt;img src="23-assumptions-and-nonparametrics_files/figure-html/unnamed-chunk-16-1.png" width="864" /&gt;

--

Тест U Манна-Уитни сравнивает медианы, а в пермутационном тесте мы решили сравнивать средние значения (хотя могли бы медианы). Это разные гипотезы.

---

class: middle, center, inverse

# Summary

---

## Summary

- Условия применимости статистических методов не всегда выполняются.

- Если нарушаются условия применимости метода, можно использовать
  - другой параметрический метод
  - трансформировать данные
  - непараметрические методы
  - пермутационные методы

---

## Что почитать

Whitlock, M., &amp; Schluter, D. (2015). The analysis of biological data (Second edition). Roberts and Company Publishers.


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="assets/macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "googlecode",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<!-- https://github.com/fnaufel/xaringan-smartify-->
<script type="text/javascript">
  smartify();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
