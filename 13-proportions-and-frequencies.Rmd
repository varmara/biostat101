---
title: Пропорции и частоты
subtitle: "Основы биостатистики, осень 2022"
author: 
  - Марина Варфоломеева
company: 'Каф. Зоологии беспозвоночных, СПбГУ'
output:
  xaringan::moon_reader:
    self-contained: true
    lib_dir: libs
    css: [ninjutsu, "assets/xaringan-themer.css", "assets/xaringan.css"]
    df_print: default
    nature:
      highlightStyle: googlecode
      highlightLines: true
      countIncrementalSlides: false
      titleSlideClass: [middle, left, inverse]
      beforeInit: "assets/macros.js"
    includes:
      in_header: "assets/xaringan_in_header.html"
      after_body: "assets/xaringan_after_body.html"
---


```{r setup, include = FALSE, cache = FALSE, purl = FALSE, fig.showtext = TRUE}
source("assets/setup.R")
knitr::opts_chunk$set(dev.args = list(png  = list(type = "cairo")))
library(xaringanExtra)
use_tile_view()
use_scribble()
use_search(show_icon = FALSE)
use_progress_bar(color = "#6d2b5e", location = "bottom", height = "10px")
use_freezeframe()
# use_webcam()
# use_panelset()
# use_extra_styles(hover_code_line = TRUE)

# http://tachyons.io/docs/
# https://roperzh.github.io/tachyons-cheatsheet/
use_tachyons()

# library(renderthis)
# to_pdf(from = "07-probabilities.Rmd",
#        to = "07-probabilities.pdf",
#        complex_slides = TRUE, partial_slides = TRUE)
```

```{r libs, include=FALSE, warning=FALSE}
library(tidyverse)
library(cowplot)
library(scales)
```


## Пропорции и частоты

- Биномиальное распределение
- Биномиальный тест для пропорций
- Доверительные интервалы для пропорций

---

class: middle, center, inverse

# Биномиальное распределение

---

## Биномиальное распределение

Случайные события с двумя исходами:

- Бросок монетки:
  - орел
  - решка
- Использование рук
  - правша
  - левша
- Заболевание
  - заболел
  - остался здоров
- Сложная операция, тяжелая болезнь или катастрофа
  - выжил
  - умер

Условно одно из событий в паре называют "успех", а другое — "неудача".

__Биномиальное распределение__ описывает вероятность того, сколько раз будет наблюдаться "успех" при определенном числе испытаний, когда вероятность успеха одинакова во всех испытаниях.

---

## Формула биномиального распределения

$$P(X~'успехов') = \binom{n}{X} \pi^X (1 - \pi)^{n-X} = \frac{n!}{X! (n-X)!} \pi^X (1 - \pi)^{n-X}$$

.pull-left[

```{r binomial-distr, echo=FALSE, purl=FALSE, opts.label='fig.medium.taller'}
mu1 <- 0.1
mu2 <- 0.5
N1 <- 10
N2 <- 50
y <-seq(0, 35, by = 1)
dfr <- data.frame(y = rep(y, 4), p = c(dbinom(y, size = N1, prob = mu1), dbinom(y,  size = N2, prob = mu1), dbinom(y,  size = N1, prob = mu2), dbinom(y,  size = N2, prob = mu2)),  pi = rep(c(mu1, mu2), each = 2*length(y)), n = rep(c(N1, N2, N1, N2), each = length(y)))

ggplot(dfr, aes(x = y, y = p)) + 
  geom_bar(stat = "identity", fill = 'grey20') + facet_grid(n ~ pi,  labeller = label_bquote(rows = n==.(n), cols = pi==.(pi))) + 
  # ggtitle("Биномиальное распределение \nпри разных параметрах") + 
  labs(x = "Число 'успехов'", y = "Вероятность")
```

]

.pull-right[

Параметры:

- $n$ — число испытаний (фиксированное), испытания независимы друг от друга
- $\pi$ — вероятность успеха одинакова во всех испытаниях.

<br/>

Биномиальный коэффициент описывает **число сочетаний из $n$ по $X$**

$$\binom{n}{X} = C_n^X = \frac{n!}{X! \cdot (n-X)!}$$ 
]

---

## Смысл биномиального коэффициента (1)

Пусть перед нами 5 улиток: 3 .red[заражены трематодами (i)], а 2 .blue[здоровы (h)]. Сколькими возможными способами могут быть расположены эти улитки?

-----

( - )   ( - )   ( - )   ( - )   ( - )

--

1-я зараженная улитка может быть расположена 5-ю способами. Допустим, так:

( - )   .red[(i-1)]   ( - )   ( - )   ( - )

--

2-я — 4-мя способами, допустим так:

( - )   .red[(i-1)]   ( - )   ( - )   .red[(i-2)]

--

Третья — 3-мя способами, допустим так:

.red[(i-3)]   .red[(i-1)]   ( - )   ( - )   .red[(i-2)]

Общее число способов, которыми могут располагаться эти зараженные улитки, _если бы они были различимы_: $5 \cdot 4 \cdot 3$

--

Но нам не важен порядок, поэтому разные варианты расположения трех зараженных улиток эквивалентны. Например вот эти два (а всего их $3 \cdot 2 \cdot 1$):

.red[(i-1)]   .red[(i-2)]   ( - )   ( - )   .red[(i-3)]  
.red[(i-3)]   .red[(i-2)]   ( - )   ( - )   .red[(i-1)] 

Поэтому число способов, которыми могут располагаться зараженные улитки, _если они не различимы_ (т.е. если нам не важен их порядок):  
$\cfrac{5 \cdot 4 \cdot 3}{3 \cdot 2 \cdot 1} = 10$

---

## Смысл биномиального коэффициента (2)

Пусть перед нами 5 улиток: 3 .red[заражены трематодами (i)], а 2 .blue[здоровы (h)]. Сколькими возможными способами могут быть расположены эти улитки?

-----

( - )   ( - )   ( - )   ( - )   ( - )

--

1-я здоровая улитка может быть расположена 5-ю способами. Допустим, так:

( - )   ( - )   ( - )   .blue[(h-1)]   ( - )

--

2-я здоровая — 4-мя способами, допустим так:

.blue[(h-2)]   ( - )   ( - )   .blue[(h-1)]   ( - )

<br/>

Общее число способов, которыми могут располагаться эти 2 здоровые улитки, _если бы они были различимы_: $5 \cdot 4$

--

Но нам не важен порядок, поэтому разные варианты расположения 2 здоровых улиток эквивалентны (и всего их $2 \cdot 1$):

.blue[(h-2)]   ( - )   ( - )   .blue[(h-1)]   ( - )  
.blue[(h-1)]   ( - )   ( - )   .blue[(h-2)]   ( - )

Поэтому число способов, которыми могут располагаться 2 здоровые улитки, _если они не различимы_ (т.е. если нам не важен их порядок):  
$\cfrac{5 \cdot 4}{2 \cdot 1} = 10$, так же, как в прошлый раз, но формула другая. Непорядок!

---

## Смысл биномиального коэффициента (3)

Пусть перед нами 5 улиток: 3 .red[заражены трематодами (i)], а 2 .blue[здоровы (h)]. Сколькими возможными способами могут быть расположены эти улитки?

-----

Как из этих двух формул сделать одну, чтобы было все равно с кого начинать — со здоровы или зараженных улиток?

$\cfrac{5 \cdot 4 \cdot 3}{3 \cdot 2 \cdot 1} = 10$, 
$\cfrac{5 \cdot 4}{2 \cdot 1} = 10$

--

Домножим числитель и знаменатель на одно и то же число:

$\cfrac{(5 \cdot 4 \cdot 3)\cdot (2 \cdot 1)}{(3 \cdot 2 \cdot 1)\cdot (2 \cdot 1)} = \cfrac{5!}{\color{red}{3}! \color{blue}{2}!}$

--

Легко заметить, что в числителе факториал общего числа улиток, а в знаменателе факториалы каждой из категорий.

$$\binom{n}{X} = C_n^X = \frac{n!}{X! \cdot (n-X)!}$$ 

---

## Вычисляем вероятность <br/>с использованием биномиального распределения

Вы собираете улиток для эксперимента.  
Вероятность того, что случайно выбранная улитка  
окажется зараженной трематодами 0.2.  

Какова вероятность того, что из 5 собранных улиток 3 заражены?

-----

--

- $\color{red}{0.2^3}$ — вероятность того, что 3 улитки будут заражены

- $\color{blue}{(1 - 0.2)^2}$ — вероятность того, что 2 улитки будут здоровы

- $\cfrac{5!}{\color{red}{3}! \color{blue}{2}!}$ — число возможных сочетаний здоровых и зараженных улиток

--

Можно воспользоваться биномиальным распределением:

$$P(X~'успехов') = \frac{n!}{X! (n-X)!} \pi^X (1 - \pi)^{n-X}$$

$$P(3) = \cfrac{5!}{\color{red}{3}! \color{blue}{2}!} \color{red}{0.2^3} \color{blue}{(1 - 0.2)^2} = 10 \cdot 0.008 \cdot 0.64 = 0.0512$$

---

##

.pull-left[

]
.pull-right[

```{r binomial-n5-p0.1, echo=FALSE, purl=FALSE, opts.label='fig.medium.taller'}
mu <- 0.1
N <- 5
y <-seq(0, N, by = 1)
dfr <- data.frame(y = rep(y, 4), p = c(dbinom(y, size = N, prob = mu)))

ggplot(dfr, aes(x = y, y = p)) + 
  geom_bar(stat = "identity", fill = 'grey20') + 
  labs(x = "Число 'успехов'", y = "Вероятность") +
  scale_x_continuous(breaks = y)
```
]





---

class: middle, center, inverse

# Summary

---

## Что почитать








